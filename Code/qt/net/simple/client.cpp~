#include <QtNetwork/QTcpServer>
#include <iostream>
#include <unistd.h>

void sayHello() {

  //_tcpSocket->waitForConnected();
  std::cout << "client connected!" << std::endl;
  _tcpSocket->write("Hello\n");
  std::cout << " say hello ..." << std::endl;
  _tcpSocket->waitForBytesWritten();
  std::cout << "Waiting echo ..." << std::endl;
  _tcpSocket->waitForReadyRead();
  _tcpSocket->readLine(_buf,sizeof(_buf));
  std::cout << "data read:" << _buf << std::endl;
  
}

int main(int argc, char *argv[])
{
  QTcpSocket _tcpSocket;
  
  std::cout << "try connection ..." << std::endl;
  _tcpSocket.connectToHost("127.0.0.1", 8080);

  if (!_tcpSocket->waitForConnected()) {
    std::cout <<_tcpSocket->errorString().toStdString() << std::endl;
    exit(0);
  } else {
    std::cout << "connection done" << std::endl;
  }

  sayHello();
  
  return 0;
}
